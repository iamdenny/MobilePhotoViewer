/**
 * Mobile Photo Viewer Component
 * @class jindo.m.PhotoViewer 
 * @names jindo.m
 * @namespace
 * @author Denny Lim<iamdenny@nhn.com>
 * @version 0.0.1
 * @since February 17, 2013
 * @extends jindo.UIComponent
 * @uses jindo.m.Scroll
 * @uses jindo.m.Flicking
 * @generated by Jindo2 Code Generator v1.0.4
 */
jindo.m.PhotoViewer = jindo.$Class({
	/** @lends jindo.m.PhotoViewer.prototype */

	/**
	 * @constructs
	 * @param {Hash Table} htOption
	 */
	$init : function(htOption) {
		this.option({
			sViewerId : '',
			nMaxThumbCount : 0,
			htThumbSize : { nWidth : 0, nHeight : 0 },
			nPreLoadDataLeft : 5,
			nPreLoadDataRight : 20,
			htPhotoSize : { nWidth : 0, nHeight : 0 },
			sAjaxUrl : '',
			htAjaxParam : '',
			htData : {},
			nStartIndex : 1,
			sEmptyTemplate : '<img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4wLWMwNjEgNjQuMTQwOTQ5LCAyMDEwLzEyLzA3LTEwOjU3OjAxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1LjEgTWFjaW50b3NoIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI3NTM5NkVENjBBQjExRTJCRkI1OEY5MkIzMEJDRkZFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI3NTM5NkVFNjBBQjExRTJCRkI1OEY5MkIzMEJDRkZFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Mjc1Mzk2RUI2MEFCMTFFMkJGQjU4RjkyQjMwQkNGRkUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Mjc1Mzk2RUM2MEFCMTFFMkJGQjU4RjkyQjMwQkNGRkUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAAAh+QQBAAAAACwAAAAAAQABAAACAkQBADs=" alt="" width="{=nWidth}" height="{=nHeight}">',
			sThumbTemplate : '<img src="{=sThumb}" alt="{=sTitie}">',
			sThumbLoadingTemplate : '<img src="../images/thumb-loading.gif" alt="">',
			sPhotoTemplate : '<img src="{=sImg}" alt="{=sTitle}">',
			sPhotoLoadingTemplate : '<img src="../images/photo-loading.gif" alt="">',
			sPrefix : 'mpv_',
			htThumbOption : {
				bUseHScroll : true,
			    bUseVScroll : false,
			    bUseMomentum : true,
			    bUseScrollbar : false,
			    bAutoResize : true,
			    nDeceleration : 0.0005,
			    nHeight : 10 			
			}
		});
		this.option(htOption);

		this._initVariables();
		this._initThumb();
		this._initPhoto();
		this._initEvents();
	},

	_initVariables : function(){
		this._welViewer = jindo.$Element(this.option('sViewerId')).addClass(this.option('sPrefix')+'viewer');
		this._woEmptyTemplate = jindo.$Template(this.option('sEmptyTemplate'));
		this._woThumbTemplate = jindo.$Template(this.option('sThumbTemplate'));
		this._woThumbLoadingTemplate = jindo.$Template(this.option('sThumbLoadingTemplate'));
		this._woPhotoTemplate = jindo.$Template(this.option('sPhotoTemplate'));
		this._woPhotoLoadingTemplate = jindo.$Template(this.option('sPhotoLoadingTemplate'));

		this._welThumb = jindo.$Element('<div>').addClass(this.option('sPrefix')+'thumb');
		this._welThumbContainer = jindo.$Element('<div>').addClass(this.option('sPrefix')+'container');
		this._welThumbContainer.appendHTML('<ul>');
		this._welThumb.append(this._welThumbContainer);
		this._welViewer.append(this._welThumb);

		this._woThumb = null;
		this._fillEmptyThumbs();
		this._resizeThumb();

		
	},

	_fillEmptyThumbs : function(){
		var welUl = this._welThumb.query('ul'),
			htData = this.option('htData'),
			htThumbSize = this.option('htThumbSize'),
			nLen = parseInt(this.option('nMaxThumbCount'), 10);
		for(var i=0; i<nLen; i++){
			var sHtml;
			if(htData[i+1]){
				sHtml = '<li>' + this._woThumbTemplate.process(htData[i+1]) + '</li>';
			}else{
				sHtml = '<li>' + this._woEmptyTemplate.process(htThumbSize) + '</li>';
			}
			var welHtml = jindo.$Element(sHtml);
			welUl.append(welHtml);
		}
		this._welThumb.query('li').addClass('on');
	},

	_initThumb : function(){
		var self = this,
			htThumbSize = this.option('htThumbSize'),
			htThumbOption = this.option('htThumbOption'),
			nLastTouch = 0, nLastLeft = 0;

		htThumbOption.nHeight = htThumbSize.nHeight;
		this._woThumb = new jindo.m.Scroll(this._welThumb, htThumbOption)
			.attach({
				'afterScroll' : function(woEvent){
					var htPos = self._woThumb.getCurrentPos(),
						nThisLeft = Math.abs(Math.round(htPos.nLeft));
					if(nThisLeft !== nLastLeft){
						nLastLeft = nThisLeft;
						var nIndex = self._getLeftIndexBy(nThisLeft);
						self._loadThumbFrom(nIndex);
					}
				},
				'touchStart' : function(woEvent){
					nLastTouch = woEvent.nLeft;
				},
				'touchEnd' : function(woEvent){
					if(nLastTouch === woEvent.nLeft && woEvent.oEvent.element.tagName === 'IMG'){
						var nSelectedIndex = self._getLeftIndexBy(woEvent.oEvent.nX + Math.abs(this.getCurrentPos().nLeft));
						self._selectThumb(nSelectedIndex);
						self._selectPhoto(nSelectedIndex);
					}
				}
			});		
	},

	_resizeThumb : function(){
		var htThumbSize = this.option('htThumbSize'),
			nWidth = this.option('nMaxThumbCount') * htThumbSize.nWidth
		this._welThumbContainer.width(nWidth);
	},

	_loadThumbFrom : function(nIndex){
		var self = this,
			aNoDataIndex = this._getNoDataIndexFrom(nIndex);
	},

	_getNoDataIndexFrom : function(nIndex){
		var nPreLoadDataLeft = (this.option('nPreLoadDataLeft') >= this.option('nMaxThumbCount')) ? this.option('nMaxThumbCount') : this.option('nPreLoadDataLeft'),
			nStartIndex = nIndex - nPreLoadDataLeft,
			nEndIndex = nStartIndex + this.option('nPreLoadDataRight'),
			aNoDataIndex = [],
			nThisIndex = nStartIndex,
			htData = this.option('htData');

		for(var i=nStartIndex; i<=nEndIndex; i++, nThisIndex++){
			if(nThisIndex < 1){
				nThisIndex = this.option('nMaxThumbCount') + nThisIndex;
			}else if(nThisIndex > this.option('nMaxThumbCount')){
				nThisIndex = 1;
			}
			if(!htData[nThisIndex]){
				aNoDataIndex.push(nThisIndex);
			}
		}
		return aNoDataIndex;
	},

	_getLeftIndexBy : function(nLeft){
		var htThumbSize = this.option('htThumbSize');
		return Math.floor(nLeft / htThumbSize.nWidth);
	},

	_selectThumb : function(nIndex){

	},

	_initPhoto : function(){

	},

	_selectPhoto : function(nIndex){

	},

	_initEvents : function(){

	}

}).extend(jindo.m.UIComponent);
